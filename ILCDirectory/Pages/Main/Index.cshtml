@page
@using ILCDirectory.Models
@model IndexModel
@{
    ViewData["Title"] = "People Index";
}

<div class="container shadow min-vh-100 py-2">
    <div class="row">
        <div class="col-lg-12">
            <div class="display-6 start-0 m-1">
                <strong><em>People</em></strong>
            </div>
        </div>
    </div>
    <div class="row no-gutters">
        <div class="col-lg-12">
            <!-- Search Form - for controller method named OnPostAsync -->
            <form method="post" class="form-group">
                <i class="fa-solid fa-magnifying-glass"></i>                
                <input asp-for="SearchText" class="me-0 pe-0" placeholder="search text" />
                <button class="btn btn-outline-secondary m-0 border-0 rounded-0 rounded-right" type="button" onclick="document.getElementById('SearchText').value = '';document.getElementById('SearchText').focus();">
                    <i class="fa fa-times"></i>
                </button>
                <button type="submit" class="btn btn-primary rounded-3" asp-page-handler="Search">Search</button>
                <span class="form-check-inline"><input class="form-check-input" asp-for="LocalSearch" type="checkbox" /><label class="form-check-label" asp-for="LocalSearch">Local</label></span>
                <span class="form-check-inline"><input class="form-check-input" asp-for="IncludeChildren" type="checkbox" /><label class="form-check-label" asp-for="IncludeChildren">Include Children</label></span>
                <span class="form-check-inline"><input class="form-check-input" asp-for="SearchPartialWords" type="checkbox" /><label class="form-check-label" asp-for="SearchPartialWords">Partial Words</label></span>
                <button class="float-end btn btn-light rounded-3" asp-page-handler="CreatePerson">Create Person</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="table-responsive">
            <table class="table accordion" id="person-table">
                <thead>
                    <tr>
                        <th scope="col">
                            Name (Last (Maiden), First (Nickname))
                        </th>
                        <th scope="col">
                            Languages Spoken
                        </th>
                        <th scope="col">
                            Current Address
                        </th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Persons)
                    {
                        <tr class="person-row" id="person-row-@item.PersonId" data-spouse-person-id="@item.SpousePersonId" data-bs-toggle="collapse" data-bs-target="#person-detail-@item.PersonId">
                            <td>
                                @item.LastName@Html.DisplayFor(modelItem => item.MaidenName),
                                @item.FirstName @Html.DisplayFor(modelItem => item.NickName)
                            </td>
                            <td>
                                @item.LanguagesSpoken
                            </td>
                            <td>
								Placeholder for Address
                            <td>
                                <span><i style = "color:maroon;" class="fa-solid fa-square-xmark"></i></span>
                            </td>
                        </tr>
                        <tr class="collapse accordion-collapse" data-bs-parent="#person-table" id="person-detail-@item.PersonId">
                            <td colspan="3">
                                <div class="container">
                                    <div class="p-5 my-4 bg-light rounded-3">
                                        <h1>Addresses</h1>
                                        <p class="lead">In today's world internet is the most popular way of connecting with the people. At <a href="https://www.tutorialrepublic.com" class="text-success" target="_blank">tutorialrepublic.com</a> you will learn the essential web development technologies along with real life practice examples, so that you can create your own website to connect with the people around the world.</p>
                                        <p><a href="https://www.tutorialrepublic.com" target="_blank" class="btn btn-success btn-lg">Get started today</a></p>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-lg-6 col-xl-4">
                                            <h2>HTML</h2>
                                            <p>HTML is the standard markup language for describing the structure of the web pages. Our HTML tutorials will help you to understand the basics of latest HTML5 language, so that you can create your own website.</p>
                                            <p><a href="https://www.tutorialrepublic.com/html-tutorial/" target="_blank" class="btn btn-success">Learn More &raquo;</a></p>
                                        </div>
                                        <div class="col-lg-6 col-xl-4">
                                            <h2>CSS</h2>
                                            <p>CSS is used for describing the presentation of web pages. CSS can save a lot of time and effort. Our CSS tutorials will help you to learn the essentials of latest CSS3, so that you can control the style and layout of your website.</p>
                                            <p><a href="https://www.tutorialrepublic.com/css-tutorial/" target="_blank" class="btn btn-success">Learn More &raquo;</a></p>
                                        </div>
                                        <div class="col-lg-6 col-xl-4">
                                            <h2>JavaScript</h2>
                                            <p>JavaScript is the most popular and widely used client-side scripting language. Our JavaScript tutorials will provide in-depth knowledge of the JavaScript including ES6 features, so that you can create interactive websites.</p>
                                            <p><a href="https://www.tutorialrepublic.com/javascript-tutorial/" target="_blank" class="btn btn-success">Learn More &raquo;</a></p>
                                        </div>
                                        <div class="col-lg-6 col-xl-4">
                                            <h2>Bootstrap</h2>
                                            <p>Bootstrap is a powerful front-end framework for faster and easier web development. Our Bootstrap tutorials will help you to learn all the features of latest Bootstrap 4 framework so that you can easily create responsive websites.</p>
                                            <p><a href="https://www.tutorialrepublic.com/twitter-bootstrap-tutorial/" target="_blank" class="btn btn-success">Learn More &raquo;</a></p>
                                        </div>
                                        <div class="col-lg-6 col-xl-4">
                                            <h2>PHP</h2>
                                            <p>PHP is the most popular server-side scripting language for creating dynamic web pages. Our PHP tutorials will help you to learn all the features of latest PHP7 scripting language so that you can easily create dynamic websites.</p>
                                            <p><a href="https://www.tutorialrepublic.com/twitter-bootstrap-tutorial/" target="_blank" class="btn btn-success">Learn More &raquo;</a></p>
                                        </div>
                                        <div class="col-lg-6 col-xl-4">
                                            <h2>SQL</h2>
                                            <p>SQL is a standard language designed for managing data in relational database management system. Our SQL tutorials will help you to learn the fundamentals of the SQL language so that you can efficiently manage your databases.</p>
                                            <p><a href="https://www.tutorialrepublic.com/twitter-bootstrap-tutorial/" target="_blank" class="btn btn-success">Learn More &raquo;</a></p>
                                        </div>
                                        <div class="col-lg-6 col-xl-4">
                                            <h2>References</h2>
                                            <p>Our references section outlines all the standard HTML5 tags and CSS3 properties along with other useful references such as color names and values, character entities, web safe fonts, language codes, HTTP messages, and more.</p>
                                            <p><a href="https://www.tutorialrepublic.com/twitter-bootstrap-tutorial/" target="_blank" class="btn btn-success">Learn More &raquo;</a></p>
                                        </div>
                                        <div class="col-lg-6 col-xl-4">
                                            <h2>FAQ</h2>
                                            <p>Our Frequently Asked Questions (FAQ) section is an extensive collection of FAQs that provides quick and working solution of common questions and queries related to web design and development with live demo.</p>
                                            <p><a href="https://www.tutorialrepublic.com/twitter-bootstrap-tutorial/" target="_blank" class="btn btn-success">Learn More &raquo;</a></p>
                                        </div>
                                    </div>
                                    <hr>
                                </div>
                            </td>
                        </tr>
@*                         <tr class="collapse accordion-collapse" data-bs-parent="#person-table" id="person-detail-@item.PersonId">
                            <td colspan="3">
                                <div id="person-detail-info-@item.PersonId">
                                    Details Loading...
                                </div>
                                <hr>
                            </td>
                        </tr>
 *@                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        var personIdLoaded = 0;
        $('.person-row').click(function () {
            // make sure the person id is different than the value already loaded in the details panes
            // if it is different, then load the new person details
            // get the person id from the row id - it is the last integer of the id after the last dash

            robbUtil.zot();

            var personId = parseInt($(this).attr('id').split('-').pop());
            var spousePersonId = parseInt($(this).attr('data-spouse-person-id'));
            if (personId != personIdLoaded) {
                $('#person-detail-info-' + personId).text("Person Details Loading...");
                $.ajax({
                    url: "@Url.Page("/Index")?handler=PersonFamilyAddressDetails",
                    method: "POST",
                    data: { personId: personId, spousePersonId: spousePersonId, __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() },
                    success: function (data) {
                        $('#person-detail-info-' + personId).html(data);
                    }
                });

                // load the address details
                $('#address-details-pane').text("Address Details Loading...");
                $.ajax({
                    url: "@Url.Page("/Index")?handler=PersonAddressDetails",
                    method: "POST",
                    data: { personId: personId, __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() },
                    success: function (data) {
                        $('#address-details-pane').html(data);
                    }
                });
                //$('#address-details-pane').load(''
                //{ id: personId, __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() } );
                // load the family details
                $('#family-details-pane').text("Family Details Loading...");
                $.ajax({
                    url: "@Url.Page("/Index")?handler=PersonFamilyDetails",
                    method: "POST",
                    data: { personId: personId, spousePersonId: spousePersonId, __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() },
                    success: function (data) {
                        $('#family-details-pane').html(data);
                    }
                });
                personIdLoaded = personId;
            }
            else {
                console.log("personId already loaded");
            }
        });
    </script>

}